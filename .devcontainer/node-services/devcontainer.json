{
    "name": "Node Services Dev (Monorepo)",
    // 指向你的基礎 docker-compose.yml 和 override 檔案
    "dockerComposeFile": [
        "../../docker-compose.yml", // 相對路徑指向專案根目錄
        "../../docker-compose.override.yml" // 明確包含 override 文件
    ],
    // 指定 Docker Compose 文件中哪個服務作為 Dev Container 的主要環境
    "service": "node-services",
    // 指定 VS Code 在容器內開啟哪個資料夾作為工作區
    // 這應與 docker-compose.override.yml 中 volumes 的目標路徑一致
    "workspaceFolder": "/workspace",
    "updateRemoteUserUID": false, 
    "customizations": {
        "vscode": {
            "extensions": [
                "dbaeumer.vscode-eslint",
                "esbenp.prettier-vscode",
                "ms-vscode.vscode-typescript-next",
                "ms-azuretools.vscode-docker",
                "nestjs.nestjs-vscode",
                "streetsidesoftware.code-spell-checker",
                "christian-kohler.path-intellisense",
                "formulahendry.auto-rename-tag"
            ]
        }
    },
    // --- Container Lifecycle ---
    // 轉發端口
    "forwardPorts": [
        8001, // Gunicorn/Flask (主機端口) -> 8000 (容器端口)
        5432, // PostgreSQL (主機端口) -> 5432 (容器端口)
        // 5000, // 新增：Flask (主機端口) -> 5000 (容器端口)
        5251, // Frontend (如果 VS Code 也需要轉發)
        3000, // api-gateway
        4000, // websocket-server
        5173, // frontend
        6379 // redis
    ],
    // 指定需要隨 Dev Container 一起啟動的其他服務
    "runServices": [
        "db",
        "backend-python",
        "frontend"
    ],
    // 使用陣列來執行多個命令
    "postCreateCommand": "sudo chown -R vscode:vscode /workspace && cd node-services && pnpm install && pnpm run build",
    "postStartCommand": "export PATH=\"/home/vscode/.local/bin:$PATH\"",
    "remoteUser": "vscode",
    "containerEnv": {
        "NODE_ENV": "development"
    }
}